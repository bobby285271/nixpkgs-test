on:
  push:
    branches:
      - main
  workflow_dispatch:
  
  
env:
  PACKAGE_ATTR: libheif
  MAIN_PROGRAM: libheif
  PR_NUMBER: master

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: cachix/install-nix-action@v17
      - run: nix-build -A ${PACKAGE_ATTR} https://github.com/NixOS/nixpkgs/archive/${PR_NUMBER}.tar.gz
      - continue-on-error: true
        run: cd ./result && nix-shell -p tree --command tree -I "nixpkgs=https://github.com/NixOS/nixpkgs/archive/nixos-unstable.tar.gz"
      - continue-on-error: true
        run: ./result/bin/${MAIN_PROGRAM} --help
      - continue-on-error: true
        run: ./result/bin/${MAIN_PROGRAM} -h
      - continue-on-error: true
        run: ./result/bin/${MAIN_PROGRAM} --version
      - continue-on-error: true
        run: ./result/bin/${MAIN_PROGRAM} version
      - continue-on-error: true
        run: ./result/bin/${MAIN_PROGRAM} -help
